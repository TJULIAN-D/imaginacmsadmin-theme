"use strict";(globalThis["webpackChunkadmin_quasar"]=globalThis["webpackChunkadmin_quasar"]||[]).push([[7396],{99776:(e,t,a)=>{a.r(t),a.d(t,{default:()=>J});var l=a(92444);function r(e,t,a,r,n,o){const i=(0,l.E1)("uploadContractRulesModal");return(0,l.Wz)(),(0,l.An)("div",null,[(0,l.K2)(i)])}var n=a(36852),o=a(30152),i=a(75836),s=(0,i.cB)({excelList:[],showModal:!1,loadingModal:!1,tableData:[]}),c=(0,l.S6)((function(){return{get excelList(){return s.excelList},set excelList(e){s.excelList=e},get showModal(){return s.showModal},set showModal(e){s.showModal=e},get loadingModal(){return s.loadingModal},set loadingModal(e){s.loadingModal=e},get tableData(){return s.tableData},set tableData(e){s.tableData=e},reset:function(){s.tableData=[],s.excelList=[],s.showModal=!1,s.loadingModal=!1}}})).value;const u=c;var d={class:"tw-flex tw-justify-center"},p={class:"tw-space-y-3 tw-text-center"},f={class:"tw-p-4 tw-mx-4 tw-mt-2 tw-rounded-md tw-border tw-shadow-md"},m=(0,l.QD)("p",{class:"tw-text-sm tw-pb-3 tw-font-semibold"},"Percentage of progress of contract rules",-1),y={class:"absolute-full flex flex-center"};function b(e,t,a,r,n,o){var i=(0,l.E1)("q-uploader"),s=(0,l.E1)("q-btn"),c=(0,l.E1)("q-badge"),u=(0,l.E1)("q-linear-progress"),b=(0,l.E1)("uploadedRecordsTable"),v=(0,l.E1)("master-modal");return(0,l.Wz)(),(0,l.Az)(v,{modelValue:e.showModal,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.showModal=t}),title:"Upload Contract Rules","custom-position":"",persistent:!0,loading:e.loadingModal,onHide:e.hide,modalWidthSize:"90vw",maximized:e.$q.screen.lt.md},{default:(0,l.Ql)((function(){return[(0,l.QD)("div",d,[(0,l.QD)("div",p,[(0,l.K2)(i,{label:"Select an Excel file",accept:".xls, .xlsx, .xlsm",onAdded:e.handleFileAdded,"hide-upload-btn":"",onRemoved:e.removeFile,ref:"uploaderFile"},null,8,["onAdded","onRemoved"]),e.isFile?((0,l.Wz)(),(0,l.Az)(s,{key:0,color:"primary",label:"Upload",icon:"fa-light fa-cloud-arrow-up",class:"tw-my-4",onClick:e.saveContractRules},null,8,["onClick"])):(0,l.g1)("",!0)])]),(0,l.QD)("div",null,[(0,l.QD)("div",f,[m,(0,l.K2)(u,{size:"25px",value:e.percentageCompleted,color:"primary"},{default:(0,l.Ql)((function(){return[(0,l.QD)("div",y,[(0,l.K2)(c,{color:"white","text-color":"primary",label:Math.floor(100*e.percentageCompleted)},null,8,["label"])])]})),_:1},8,["value"])]),(0,l.K2)(b)])]})),_:1},8,["modelValue","loading","onHide","maximized"])}var v=a(31784),h=a(7460),g=a.n(h),w=a(20584),L=a(8932),I=function(e,t,a,l){function r(e){return e instanceof a?e:new a((function(t){t(e)}))}return new(a||(a=Promise))((function(a,n){function o(e){try{s(l.next(e))}catch(t){n(t)}}function i(e){try{s(l["throw"](e))}catch(t){n(t)}}function s(e){e.done?a(e.value):r(e.value).then(o,i)}s((l=l.apply(e,t||[])).next())}))},x=function(e,t){var a,l,r,n,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return n={next:i(0),throw:i(1),return:i(2)},"function"===typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function i(e){return function(t){return s([e,t])}}function s(i){if(a)throw new TypeError("Generator is already executing.");while(n&&(n=0,i[0]&&(o=0)),o)try{if(a=1,l&&(r=2&i[0]?l["return"]:i[0]?l["throw"]||((r=l["return"])&&r.call(l),0):l.next)&&!(r=r.call(l,i[1])).done)return r;switch(l=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,l=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(r=o.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){o.label=i[1];break}if(6===i[0]&&o.label<r[1]){o.label=r[1],r=i;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(i);break}r[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(s){i=[6,s],l=0}finally{a=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},q=function(e,t,a){if(a||2===arguments.length)for(var l,r=0,n=t.length;r<n;r++)!l&&r in t||(l||(l=Array.prototype.slice.call(t,0,r)),l[r]=t[r]);return e.concat(l||Array.prototype.slice.call(t))};function C(e){void 0===e&&(e=null);var t=(0,i.IL)(0),a=(0,l._S)().proxy,r=(0,i.IL)(null),n=(0,i.IL)(!1),o=(0,i.IL)(),s=(0,l.S6)({get:function(){return u.showModal},set:function(e){u.showModal=e}}),c=(0,l.S6)({get:function(){return u.loadingModal},set:function(e){u.loadingModal=e}}),d=(0,l.S6)((function(){return u.excelList}));function p(e){n.value=!0,o.value=new FileReader,o.value.onload=function(e){var t=new Uint8Array(e.target.result);f(t)},o.value.readAsArrayBuffer(e[0])}function f(e){var t=v.gH(e,{type:"array"}),a=t.Sheets[t.SheetNames[1]],l=v.c$.sheet_to_json(a);u.excelList=l}function m(){var e;return I(this,void 0,void 0,(function(){var t;return x(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),c.value=!0,[4,b()];case 1:return a.sent(),null===(e=r.value)||void 0===e||e.reset(),u.excelList=[],c.value=!1,n.value=!1,L.Qb.success("I completed the upload of the records successfully"),[3,3];case 2:return t=a.sent(),console.log(t),c.value=!1,n.value=!1,[3,3];case 3:return[2]}}))}))}function y(e){return I(this,void 0,void 0,(function(){return x(this,(function(t){switch(t.label){case 0:return[4,w.c.put("apiRoutes.qramp.passengerContractRulesUpsert",{attributes:e})];case 1:return t.sent(),[2]}}))}))}function b(){return I(this,void 0,void 0,(function(){var e,a,l,r,n,o,i,s,c,d;return x(this,(function(p){switch(p.label){case 0:e=u.excelList.length,a=0,l=["Contract","Contract Line Workday ID","Contract Line Name","Contract Line Description","SI","Invoice Line Memo","Rate"],r=0,n=u.excelList,p.label=1;case 1:if(!(r<n.length))return[3,11];if(o=n[r],i=o,s=Object.keys(i),!(i.Rate>0)||g().isEqual(s,l))return[3,8];if(c=q(q([],l,!0),["Operation Types"],!1),g().isEqual(s,c))return[3,6];p.label=2;case 2:return p.trys.push([2,4,,5]),[4,y(o)];case 3:return p.sent(),i.message={text:"OK SUCCESS",color:"green"},[3,5];case 4:return d=p.sent(),console.error("Error updating passenger contract rules:",d),i.message={text:d.message,color:"red"},[3,5];case 5:return[3,7];case 6:i.message={text:"Ignored by operation Type",color:"orange"},p.label=7;case 7:return[3,9];case 8:0===i.Rate&&(i.message={text:"Ignored by rate 0",color:"orange"}),g().isEqual(s,l)&&(i.message={text:"The rule is ignored because you have empty data",color:"orange"}),p.label=9;case 9:a++,t.value=a/e,u.tableData.push(i),p.label=10;case 10:return r++,[3,1];case 11:return[2]}}))}))}function h(){u.tableData=[],u.excelList=[],o.value=null,n.value=!1,t.value=0}function C(){u.reset(),a.$root.$emit("crud.data.refresh")}return(0,l._O)((function(){u.reset(),n.value=!1,t.value=0})),{showModal:s,loadingModal:c,hide:C,handleFileAdded:p,saveContractRules:m,excelList:d,removeFile:h,uploaderFile:r,isFile:n,uploadContractRulesStore:u,percentageCompleted:t}}var R=a(74044),M={class:"q-pa-md"};function T(e,t,a,r,n,o){var i=(0,l.E1)("q-td"),s=(0,l.E1)("q-badge"),c=(0,l.E1)("q-tr"),u=(0,l.E1)("q-table");return(0,l.Wz)(),(0,l.An)("div",M,[(0,l.K2)(u,{title:"Contract rules upload status",rows:e.tableData,columns:e.columns,"row-key":"name",class:"stick-table","rows-per-page-options":[0]},{body:(0,l.Ql)((function(e){return[(0,l.K2)(c,{props:e},{default:(0,l.Ql)((function(){return[(0,l.K2)(i,{key:"Contract Line Workday ID",props:e},{default:(0,l.Ql)((function(){return[(0,l.mY)((0,R.WA)(e.row["Contract Line Workday ID"]),1)]})),_:2},1032,["props"]),(0,l.K2)(i,{key:"Invoice Line Memo",props:e},{default:(0,l.Ql)((function(){return[(0,l.mY)((0,R.WA)(e.row["Invoice Line Memo"]),1)]})),_:2},1032,["props"]),(0,l.K2)(i,{key:"Message",props:e},{default:(0,l.Ql)((function(){return[(0,l.K2)(s,{color:e.row.message.color},{default:(0,l.Ql)((function(){return[(0,l.mY)((0,R.WA)(e.row.message.text),1)]})),_:2},1032,["color"])]})),_:2},1032,["props"])]})),_:2},1032,["props"])]})),_:1},8,["rows","columns"])])}function A(e){void 0===e&&(e=null);var t=(0,l.S6)((function(){return u.excelList})),a=(0,l.S6)((function(){return u.tableData})),r=[{name:"Contract Line Workday ID",label:"Contract Line Workday ID",align:"left",field:"Contract Line Workday ID"},{name:"Invoice Line Memo",label:"Invoice Line Memo",align:"left",field:"Invoice Line Memo"},{name:"Message",label:"Message",align:"left",field:"message"}];return{excelList:t,columns:r,tableData:a}}var k=function(){return k=Object.assign||function(e){for(var t,a=1,l=arguments.length;a<l;a++)for(var r in t=arguments[a],t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},k.apply(this,arguments)};const D=(0,l._M)({setup:function(){return k({},A())}});var Q=a(68716),E=a(40792),S=a(45144),O=a(50213),W=a(29104),F=a(95252),_=a.n(F);const N=(0,Q.c)(D,[["render",T]]),$=N;_()(D,"components",{QTable:E.c,QTr:S.c,QTd:O.c,QBadge:W.c});var K=function(){return K=Object.assign||function(e){for(var t,a=1,l=arguments.length;a<l;a++)for(var r in t=arguments[a],t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},K.apply(this,arguments)};const P=(0,l._M)({components:{uploadedRecordsTable:$},setup:function(){return K({},C())}});var z=a(59600),U=a(99140),j=a(48488);const B=(0,Q.c)(P,[["render",b]]),V=B;_()(P,"components",{QUploader:z.c,QBtn:U.c,QLinearProgress:j.c,QBadge:W.c});var G=a(86284);const Y={components:{uploadContractRulesModal:V},data(){return{crudId:this.$uid(),externalId:null,productList:[]}},watch:{"crudInfo.contractLineId":{deep:!0,handler:async function(e,t){if(!e)return;const a=await w.c.show("apiRoutes.qsetupagione.contractLines",e,{refresh:!0});this.externalId=a.data.workdaySalesLineItemId||null;const l=await w.c.index("apiRoutes.qramp.products",{refresh:!0,params:{filter:{externalId:this.externalId}}});this.productList=l.data.map((e=>({label:e.fullName,value:e.id})))}}},beforeCreate(){this.$nextTick((async()=>{await(0,o.c)().setIsPassenger(!0),await Promise.all([(0,n["default"])().getACTypes(),(0,n["default"])().getOperationType()])}))},computed:{crudData(){return{crudId:this.crudId,apiRoute:"apiRoutes.qramp.passengerContractRules",permission:"ramp.passenger-contract-rules",create:{title:"Create passenger contract rules"},extraActions:[{props:{icon:"fa-light fa-cloud-arrow-up",label:"Upload contract rules"},label:"Upload contract rules",action:()=>{this.visibleModal(!0)}}],read:{columns:[{name:"id",label:this.$tr("isite.cms.form.id"),field:"id",style:"width: 50px",action:e=>!1},{name:"contractId",label:"Contract",field:"contract",format:e=>e?e.contractName:"-",popupEdit:!0},{name:"contractLineWId",label:"Contract Line WID",field:"contractLine",format:e=>e?e.contractLineWorkdayId:"-",popupEdit:!0},{name:"invoiceLineMemo",label:"Invoice Line Memo",field:"contractLine",format:e=>e?e.invoiceLineMemo:"-",popupEdit:!0},{name:"products",label:"Product",field:"product",format:e=>e?e.name:"-",popupEdit:!0},{name:"aircraftTypes",label:"Aircraft Types",field:"aircraftTypes",format:e=>e||"-",formatAsync:async e=>{const t=await(0,n["default"])().getACTypesList().filter((t=>{const a=Array.isArray(e.aircraftTypes)?e.aircraftTypes:[];return a.includes(String(t.id))})).map((e=>e.fullName)).join(", ");return`${t||"-"}`}},{name:"operationTypes",label:"Operation types",field:"operationTypes",format:e=>e||"-",formatAsync:async e=>{const t=await(0,n["default"])().getOperationTypeList().filter((t=>{const a=Array.isArray(e.operationTypes)?e.operationTypes:[];return a.includes(String(t.id))})).map((e=>e.operationName)).join(", ");return`${t||"-"}`}},{name:"delay",label:"Delay",field:"delay",format:e=>"boolean"===typeof e?e?"Yes":"No":"-"},{name:"cancellationType",label:"Cancellation type",field:"cancellationType",format:e=>e||"-"},{name:"valueRule",label:"Value rule",field:"valueRule",format:e=>e||"-"},{name:"valueFrom",label:"Value from",field:"valueFrom",format:e=>e||"-"},{name:"valueTo",label:"Value to",field:"valueTo",format:e=>e||"-"},{name:"actions",label:this.$tr("isite.cms.form.actions"),align:"left"}],filters:{contractId:{value:null,type:"select",quickFilter:!0,loadOptions:{apiRoute:"apiRoutes.qsetupagione.contracts",select:{label:"contractName",id:"id"},filterByQuery:!0},props:{label:"Contract",clearable:!0}},productId:{value:null,type:"select",quickFilter:!0,loadOptions:{apiRoute:"apiRoutes.qramp.products",select:{label:"fullName",id:"id"}},props:{label:"Sales Item",clearable:!0}}},actions:[],requestParams:{include:"contract,contractLine,product"}},update:{title:"Update passenger contract rules"},delete:!0,formLeft:{contractId:{value:null,type:"select",loadOptions:{apiRoute:"apiRoutes.qramp.setupContracts",select:{label:"contractName",id:"id"},filterByQuery:!0},props:{label:"Contract",clearable:!0,rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired")]}},contractLineId:{value:null,type:"select",loadOptions:{apiRoute:"apiRoutes.qsetupagione.contractLines",select:{label:"fullName",id:"id"},requestParams:{filter:{contractId:this.crudInfo.contractId}}},props:{label:"Contract Line",clearable:!0,readonly:!this.crudInfo.contractId,rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired")]}},productId:{value:null,type:"select",props:{label:"Product",clearable:!0,readonly:!this.crudInfo.contractLineId,rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired")],options:this.productList}},aircraftTypes:{value:[],type:"select",props:{label:"Aircraft Types",multiple:!0,useChips:!0,clearable:!0,color:"primary","hide-bottom-space":!1},loadOptions:{apiRoute:"apiRoutes.qfly.aircraftTypes",select:{label:"fullNameWithType",id:"id"}}},operationTypes:{value:[],type:"select",props:{label:"Operation Types",multiple:!0,useChips:!0,clearable:!0,color:"primary"},loadOptions:{apiRoute:"apiRoutes.qramp.operationTypes",select:{label:"operationName",id:"id"},requestParams:{filter:{company:G.mI}}}},delay:{value:null,type:"select",props:{label:"Delay",options:[{label:"Yes",value:!0},{label:"No",value:!1}]}},cancellationType:{value:null,type:"select",props:{label:"Cancellation type",clearable:!0,color:"primary",options:[{label:"Cancelled Flight",value:"cancelledFlight"},{label:"Cancelled Flight W/Services",value:"cancelledFlightWServices"}]}},valueRule:{value:null,type:"select",props:{label:"Value rule",clearable:!0,color:"primary",options:[{label:"Greater Than",value:"Greater Than"},{label:"Greater than or equal",value:"Greater than or equal"},{label:"Less than",value:"Less than"},{label:"Less than or equal",value:"Less than or equal"},{label:"Between",value:"Between"},{label:"Equal",value:"Equal"}]}},valueFrom:{value:null,type:"input",props:{label:"Value from"}},valueTo:{value:null,type:"input",props:{label:"Value to"}},quantityRule:{value:null,type:"select",props:{label:"Quantity Rule",clearable:!0,color:"primary",options:[{label:"Equal",value:"Equal"},{label:"Surplus",value:"Surplus"},{label:"All",value:"All"}]}},quantity:{value:null,type:"input",props:{label:"Quantity"}}},formRight:{}}},crudInfo(){return this.$store.state.qcrudComponent.component[this.crudId]||{}}},methods:{visibleModal(e=!1){u.showModal=e}}},H=(0,Q.c)(Y,[["render",r]]),J=H}}]);