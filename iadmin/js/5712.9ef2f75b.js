"use strict";(globalThis["webpackChunkadmin_quasar"]=globalThis["webpackChunkadmin_quasar"]||[]).push([[5712],{15712:(e,t,o)=>{o.r(t),o.d(t,{default:()=>w});var i=o(92444),s=o(74044);const l={key:0,class:"box"},a={class:"text-grey-7 q-mr-xs"},r=["innerHTML"],n={key:0,class:"q-mt-sm"},d={class:"text-grey-7 q-mr-xs"},h={class:"q-my-sm",style:{"word-wrap":"break-word"}},c={class:"text-grey-7 q-mr-xs"},p={class:"ellipsis"},m={class:"text-grey-7 q-mr-xs"};function u(e,t,o,u,b,f){const y=(0,i.E1)("q-tooltip"),k=(0,i.E1)("master-modal");return(0,i.Wz)(),(0,i.Az)(k,{modelValue:b.showModal,"onUpdate:modelValue":t[0]||(t[0]=e=>b.showModal=e),onHide:t[1]||(t[1]=e=>f.resetModal()),title:b.hook?b.hook.title:"",loading:b.loading,actions:f.actionsModal},{default:(0,i.Ql)((()=>[b.hook?((0,i.Wz)(),(0,i.An)("div",l,[(0,i.QD)("section",null,[(0,i.QD)("label",a,(0,s.WA)(e.$tr("isite.cms.form.description"))+":",1),(0,i.QD)("div",{innerHTML:b.hook.description},null,8,r),b.hook.callEveryMinutes?((0,i.Wz)(),(0,i.An)("div",n,[(0,i.QD)("label",d,(0,s.WA)(e.$tr("iwebhooks.cms.form.callEveryMinutes"))+":",1),(0,i.mY)(" "+(0,s.WA)(b.hook.callEveryMinutes),1)])):(0,i.g1)("",!0)]),(0,i.QD)("section",null,[(0,i.QD)("div",h,[(0,i.QD)("label",c,(0,s.WA)(e.$tr("iwebhooks.cms.form.endpoint"))+":",1),(0,i.QD)("p",p,(0,s.WA)(b.hook.endpoint),1),(0,i.K2)(y,null,{default:(0,i.Ql)((()=>[(0,i.mY)((0,s.WA)(b.hook.endpoint),1)])),_:1})]),(0,i.QD)("div",null,[(0,i.QD)("label",m,(0,s.WA)(e.$tr("iwebhooks.cms.form.httpMethod"))+":",1),(0,i.mY)(" "+(0,s.WA)(b.hook.httpMethod),1)])])])):(0,i.g1)("",!0)])),_:1},8,["modelValue","title","loading","actions"])}var b=o(18528)["c"];const f={data(){return{crudId:this.$uid(),showModal:!1,hook:null,loading:!1,loadingBtn:!1}},computed:{crudData(){const e=!!this.$hasAccess("iwebhooks.hooks.dispatch");return{crudId:this.crudId,entityName:b("main.qwebhook.entityNames.hook"),apiRoute:"apiRoutes.qwebhook.hooks",permission:"iwebhooks.hooks",create:{title:this.$tr("iwebhooks.cms.title.newHook")},read:{columns:[{name:"id",label:this.$tr("isite.cms.form.id"),field:"id",align:"left"},{name:"title",label:this.$tr("isite.cms.form.title"),field:"title",align:"rigth"},{name:"type",label:this.$tr("isite.cms.form.type"),field:"type",format:e=>e?.title||"-",align:"rigth"},{name:"httpMethod",label:this.$tr("iwebhooks.cms.form.httpMethod"),field:"httpMethod",align:"rigth"},{name:"endpoint",label:this.$tr("iwebhooks.cms.form.endpoint"),field:"endpoint",align:"left",action:e=>this.openModal(e)},{name:"category",label:this.$tr("isite.cms.form.category"),field:"category",align:"center",format:e=>e?.title||"-"},{name:"eventType",label:this.$tr("isite.cms.label.event"),field:"eventType",align:"center",format:e=>e?.title||"-"},{name:"eventEntity",label:this.$tr("isite.cms.label.entity"),field:"eventEntity",align:"center",format:e=>e||"-"},{name:"created_at",label:this.$tr("isite.cms.form.createdAt"),field:"createdAt",align:"left",format:e=>e?this.$trd(e):"-"},{name:"updated_at",label:this.$tr("isite.cms.form.updatedAt"),field:"updatedAt",align:"left",format:e=>e?this.$trd(e):"-"},{name:"actions",label:this.$tr("isite.cms.form.actions"),align:"left"}],requestParams:{include:"category,country"},actions:[{icon:"fa-regular fa-rocket",tooltip:this.$tr("iwebhooks.cms.label.dispatch"),vIf:e,color:"blue",action:e=>this.openModal(e)}]},update:{title:this.$tr("iwebhooks.cms.title.updateHook"),requestParams:{include:"category"}},delete:!0,formLeft:{id:{value:""},title:{value:"",type:"input",isTranslatable:!0,required:!0,props:{label:`${this.$tr("isite.cms.form.title")}*`}},httpMethod:{value:null,type:"select",required:!0,props:{label:`${this.$tr("iwebhooks.cms.form.httpMethod")}*`},loadOptions:{apiRoute:"apiRoutes.qsite.configs",select:{label:"label",id:"value"},requestParams:{filter:{configName:"Iwebhooks.config.httpMethodsOptions"}}}},endpoint:{value:"",type:"input",required:!0,help:{description:this.$tr("iwebhooks.cms.label.helpFieldEndpoint")},props:{label:`${this.$tr("iwebhooks.cms.form.endpoint")}*`}},headers:{type:"json",props:{label:this.$tr("iwebhooks.cms.form.headers")}},body:{type:"json",props:{label:this.$tr("iwebhooks.cms.form.body")}}},formRight:{categoryId:{type:"crud",props:{crudType:"select",crudData:o.e(5848).then(o.bind(o,55848)),crudProps:{label:`${this.$tr("isite.cms.form.category")}*`,rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired")]},config:{options:{label:"title",value:"id"}}}},typeId:{value:"1",type:"select",required:!0,props:{label:this.$tr("isite.cms.form.type")+"*"},loadOptions:{apiRoute:"apiRoutes.qwebhook.types"}},eventEntity:{type:"treeSelect",require:!0,props:{label:`${this.$tr("isite.cms.label.entity")}*`,disableBranchNodes:!0,vIf:"1"==this.crudInfo.typeId},loadOptions:{apiRoute:"apiRoutes.qsite.modulesInfo",requestParams:{filter:{asSelect:!0}},select:{label:"name",id:"path"}}},eventTypeId:{type:"select",require:!0,props:{label:`${this.$tr("isite.cms.label.event")}*`,vIf:"1"==this.crudInfo.typeId},loadOptions:{apiRoute:"apiRoutes.qwebhook.eventTypes"}},actionLabel:{value:"",type:"input",isTranslatable:!0,props:{label:this.$tr("iwebhooks.cms.form.actionLabel"),vIf:"2"==this.crudInfo.typeId}},maskEndpoint:{value:"",type:"input",isTranslatable:!0,props:{label:this.$tr("iwebhooks.cms.form.maskEndpoint"),vIf:"2"==this.crudInfo.typeId}},description:{name:"description",value:"",type:"input",isTranslatable:!0,props:{label:`${this.$tr("isite.cms.form.description")}`,type:"textarea",rows:"3",vIf:"2"==this.crudInfo.typeId}},callEveryMinutes:{value:null,type:"input",props:{label:this.$tr("iwebhooks.cms.form.callEveryMinutes"),type:"number",vIf:"2"==this.crudInfo.typeId}},countryId:{value:null,type:"select",props:{label:this.$tr("isite.cms.label.country"),clearable:!0,vIf:"2"==this.crudInfo.typeId},loadOptions:{apiRoute:"apiRoutes.qlocations.countries",select:{label:"name",id:"id"},filterByQuery:!0}},redirectLink:{value:"",type:"input",props:{label:this.$tr("iwebhooks.cms.form.redirectLink"),vIf:"2"==this.crudInfo.typeId}}}}},crudInfo(){return this.$store.state.qcrudComponent.component[this.crudId]||{}},actionsModal(){return[{props:{color:"primary",class:"full-width",vIf:!!this.hook?.actionLabel,label:this.hook?.actionLabel??"",loading:0!==this.hook?.isLoading||this.loadingBtn},action:()=>this.runWebhook(this.hook.id)}]}},methods:{resetModal(){this.showModal=!1,this.hook=null},openModal(e){this.showModal=!0,this.getHook(e.id)},async getHook(e){this.loading=!0;const t={refresh:!0};await this.$crud.show("apiRoutes.qwebhook.hooks",e,t).then((e=>{this.hook=e.data})).catch((e=>this.$alert.error(this.$tr("isite.cms.message.errorRequest")))),this.loading=!1},async runWebhook(e){this.loadingBtn=!0,await this.$crud.post(`${b("apiRoutes.qwebhook.hooks")}/dispatch/${e}`).catch((e=>this.$alert.error(this.$tr("isite.cms.message.errorRequest")))),this.loadingBtn=!1}}};var y=o(68716),k=o(90111),$=o(95252),g=o.n($);const v=(0,y.c)(f,[["render",u]]),w=v;g()(f,"components",{QTooltip:k.c})}}]);