"use strict";(globalThis["webpackChunkadmin_quasar"]=globalThis["webpackChunkadmin_quasar"]||[]).push([[7688],{87688:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Re});var n=r(92444);function a(e,t,a,o,i,l){const s=(0,n.E1)("fuelingForm"),u=(0,n.E1)("flightDetail"),c=(0,n.E1)("inner-loading"),d=(0,n.E1)("crud");return(0,n.Wz)(),(0,n.An)("div",null,[(0,n.K2)(s,{onRefreshData:t[0]||(t[0]=e=>l.getDataTable(!0))}),(0,n.K2)(u),(0,n.K2)(c,{visible:i.loadingBulk},null,8,["visible"]),(0,n.K2)(d,{"crud-data":r.e(7400).then(r.bind(r,17400)),"custom-data":l.crudData,ref:"crudComponent",title:e.$route.meta.title},null,8,["crud-data","custom-data","title"])])}var o=r(86284),i=r(30152),l=r(96332),s=r(36852),u=r(8932);function c(e,t,r,a,o,i){var l=(0,n.E1)("createForm"),s=(0,n.E1)("stepper"),u=(0,n.E1)("master-modal");return(0,n.Wz)(),(0,n.An)("div",null,[(0,n.K2)(u,{modelValue:e.showModal,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.showModal=t}),title:e.titleModal,persistent:!0,loading:e.loading,width:e.widthModal,actions:e.actions,onHide:e.clear},{default:(0,n.Ql)((function(){return[(0,n.QD)("div",null,[e.isUpdate?((0,n.Wz)(),(0,n.Az)(s,{key:1,ref:"refStepper"},null,512)):((0,n.Wz)(),(0,n.Az)(l,{key:0,ref:"refCreateForm",class:"tw-px-4",onRefreshData:t[0]||(t[0]=function(t){return e.getDataTable()})},null,512))])]})),_:1},8,["modelValue","title","loading","width","actions","onHide"])])}var d=r(75836),f=r(6472),p=r(76719),m={class:"tw-mt-6 tw-mb-20 row q-col-gutter-lg"},h={class:"col-12 col-md-6"},b={class:"col-12 col-md-6"};function v(e,t,r,a,o,i){var l=(0,n.E1)("customer"),s=(0,n.E1)("dynamic-field"),u=(0,n.E1)("q-form");return(0,n.Wz)(),(0,n.Az)(u,{ref:"refFlight"},{default:(0,n.Ql)((function(){return[(0,n.QD)("div",m,[(0,n.QD)("div",h,[(0,n.K2)(l,{dataForm:e.form,readonly:e.disabledReadonly},null,8,["dataForm","readonly"]),((0,n.Wz)(!0),(0,n.An)(n.ae,null,(0,n.mi)(e.formFields.flyFormLeft,(function(t,r){return(0,n.Wz)(),(0,n.An)("div",{key:r},[((0,n.Wz)(),(0,n.Az)(s,{key:r,id:r,field:t,modelValue:e.form[r],"onUpdate:modelValue":function(t){return e.form[r]=t}},null,8,["id","field","modelValue","onUpdate:modelValue"]))])})),128))]),(0,n.QD)("div",b,[((0,n.Wz)(!0),(0,n.An)(n.ae,null,(0,n.mi)(e.formFields.flyFormRight,(function(t,r){return(0,n.Wz)(),(0,n.An)("div",{key:r},[((0,n.Wz)(),(0,n.Az)(s,{key:r,id:r,field:t,modelValue:e.form[r],"onUpdate:modelValue":function(t){return e.form[r]=t}},null,8,["id","field","modelValue","onUpdate:modelValue"]))])})),128))])])]})),_:1},512)}var g=r(78944),y=r(47507),w=r.n(y);function I(){var e=(0,d.IL)(null),t=(0,n.S6)((function(){return N.form})),r=(0,n.S6)((function(){return(0,i.c)().disabledReadonly()})),a=(0,n.S6)((function(){var e=(0,s["default"])().getStationList().find((function(e){return e.id==t.value.stationId})),r=null===e||void 0===e?void 0:e.airportId,n=(0,s["default"])().getAirportsList().find((function(e){return e.id==r}))||null;return n?w().tz(n.timezone).format("z"):""})),o=(0,n.S6)((function(){return!u.is.hasAccess("ramp.work-orders.edit-status")||r.value})),l=(0,n.S6)((function(){return{flyFormLeft:{stationId:{name:"stationId",value:"",type:"select",props:{rules:[function(e){return!!e||u._s.tr("isite.cms.message.fieldRequired")}],selectByDefault:!0,readonly:r.value,label:"*".concat(u._s.tr("ifly.cms.form.station")),clearable:!0,color:"primary",options:(0,s["default"])().getStationList().map((function(e){return{label:e.fullName,value:e.id}})),suffix:a.value}},acTypeId:{value:null,type:"select",props:{rules:[function(e){return!!e||u._s.tr("isite.cms.message.fieldRequired")}],readonly:r.value,label:"*".concat(u._s.tr("ifly.cms.form.acType")),clearable:!0,color:"primary","hide-bottom-space":!1,options:(0,s["default"])().getACTypesList().map((function(e){return{label:e.model,value:e.id}}))},label:u._s.tr("ifly.cms.form.acType")},scheduleDate:{value:null,type:"fullDate",props:{rules:[function(e){return!!e||u._s.tr("isite.cms.message.fieldRequired")}],hint:"Format: MM/DD/YYYY HH:mm",mask:"MM/DD/YYYY HH:mm","place-holder":"MM/DD/YYYY HH:mm",readonly:r.value,label:"Service date",clearable:!0,color:"primary",format24h:!0}}},flyFormRight:{carrierId:{value:null,type:"select",props:{rules:[function(e){return!!e||u._s.tr("isite.cms.message.fieldRequired")}],readonly:r.value,label:"*".concat(u._s.tr("ifly.cms.form.carrier")),clearable:!0,color:"primary","hide-bottom-space":!1,options:(0,s["default"])().getAirlinesList().map((function(e){return{label:e.airlineName,value:e.id}}))},label:u._s.tr("ifly.cms.form.carrier")},statusId:{name:"statusId",value:1,type:"select",props:{rules:[function(e){return!!e||u._s.tr("isite.cms.message.fieldRequired")}],readonly:o.value,label:"*".concat(u._s.tr("ifly.cms.form.status")),clearable:!0,color:"primary","hide-bottom-space":!1,options:(0,s["default"])().getWorkOrderStatusesList().map((function(e){return{label:e.statusName,value:e.id}}))},label:u._s.tr("ifly.cms.form.status")},fuelingTicketNumber:{value:null,type:"input",props:{readonly:r.value,rules:[function(e){return!!e||u._s.tr("isite.cms.message.fieldRequired")}],label:"*Fueling ticket number"},label:u._s.tr("ifly.cms.form.operation")},fuelingRegistration:{value:null,type:"input",props:{readonly:r.value,label:"Aircraft Registration"}}}}}));return(0,n.u2)((function(){N.refsGlobal={refFlight:e.value}})),{formFields:l,form:t,refFlight:e,disabledReadonly:r}}var k=function(){return k=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r],t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},k.apply(this,arguments)};const S=(0,n._M)({components:{customer:g.c},setup:function(){return k({},I())}});var O=r(68716),M=r(14288),R=r(95252),T=r.n(R);const _=(0,O.c)(S,[["render",v]]),A=_;T()(S,"components",{QForm:M.c});var F=r(78792),$=r(38880);const q=(0,d.IL)([{refs:"refFlight",title:"Flight",icon:"fa-regular fa-plane",step:1,component:A,error:!1,done:!1},{refs:"refServices",title:"Services",icon:"fa-regular fa-briefcase-blank",step:2,component:F.c,error:!1,done:!1},{refs:"refRemark",title:"Remark",icon:"fa-regular fa-comment-dots",step:3,component:$.c,error:!1,done:!1}]).value;var D=r(49456),x=r.n(D),L=function(){return L=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r],t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},L.apply(this,arguments)},C=function(e,t,r,n){function a(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function i(e){try{s(n.next(e))}catch(t){o(t)}}function l(e){try{s(n["throw"](e))}catch(t){o(t)}}function s(e){e.done?r(e.value):a(e.value).then(i,l)}s((n=n.apply(e,t||[])).next())}))},W=function(e,t){var r,n,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(e){return function(t){return s([e,t])}}function s(l){if(r)throw new TypeError("Generator is already executing.");while(o&&(o=0,l[0]&&(i=0)),i)try{if(r=1,n&&(a=2&l[0]?n["return"]:l[0]?n["throw"]||((a=n["return"])&&a.call(n),0):n.next)&&!(a=a.call(n,l[1])).done)return a;switch(n=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,n=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(a=i.trys,!(a=a.length>0&&a[a.length-1])&&(6===l[0]||2===l[0])){i=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){i.label=l[1];break}if(6===l[0]&&i.label<a[1]){i.label=a[1],a=l;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(l);break}a[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(s){l=[6,s],n=0}finally{r=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},E=function(e,t,r){if(r||2===arguments.length)for(var n,a=0,o=t.length;a<o;a++)!n&&a in t||(n||(n=Array.prototype.slice.call(t,0,a)),n[a]=t[a]);return e.concat(n||Array.prototype.slice.call(t))},U=(0,d.cB)({refsGlobal:{},step:1,showModal:!1,titleModal:"",loading:!1,updateModal:!1,widthModal:"35vw",isUpdate:!1,form:{id:null,customerId:null,contractId:null,statusId:null,type:o.JU,businessUnitId:o.GK,stationId:null,acTypeId:null,carrierId:null,fuelingTicketNumber:null,fuelingRegistration:null,scheduleDate:null},emitEvent:{}}),P=(0,n.S6)((function(){return{get showModal(){return U.showModal},set showModal(e){U.showModal=e},get isUpdate(){return U.isUpdate},set isUpdate(e){U.isUpdate=e},get titleModal(){return U.titleModal},set titleModal(e){U.titleModal=e},get widthModal(){return U.widthModal},set widthModal(e){U.widthModal=e},get loading(){return U.loading},set loading(e){U.loading=e},get step(){return U.step},set step(e){U.step=e},get refsGlobal(){return U.refsGlobal},set refsGlobal(e){U.refsGlobal=L({},e)},get form(){return U.form},set form(e){e.id&&(U.form.id=e.id),U.form.customerId=e.customerId||null,U.form.contractId=e.contractId||null,U.form.stationId=e.stationId||null,U.form.acTypeId=e.acTypeId||null,U.form.carrierId=e.carrierId||null,U.form.statusId=e.statusId||null,U.form.fuelingTicketNumber=e.fuelingTicketNumber||null,U.form.fuelingRegistration=e.fuelingRegistration||null,U.form.scheduleDate=e.scheduleDate?x()(e.scheduleDate).format("MM/DD/YYYY HH:mm"):null,(0,i.c)().setTypeWorkOrder(e.type),(0,i.c)().setWorkOrderItems(e.workOrderItems),(0,f.c)().init().then(),(0,p.c)().setForm(e),(0,i.c)().setStatusId(U.form.statusId)},changeStatus:function(e){U.form.statusId=e},payload:function(){return C(this,void 0,void 0,(function(){var e,t;return W(this,(function(r){switch(r.label){case 0:return[4,(0,f.c)().getServiceListSelected()];case 1:return e=r.sent(),t=(0,p.c)().getForm(),[2,L(L(L({},U.form),t),{workOrderItems:E([],e,!0)})]}}))}))},get emitEvent(){return U.emitEvent},set emitEvent(e){U.emitEvent=L({},e)},reset:function(){U.step=1,U.showModal=!1,U.titleModal="",U.isUpdate=!1,U.loading=!1,U.form={id:null,customerId:null,contractId:null,statusId:null,type:o.JU,businessUnitId:o.GK,stationId:null,acTypeId:null,carrierId:null,fuelingTicketNumber:null,fuelingRegistration:null,scheduleDate:null},q.forEach((function(e){e.error=!1}))}}})).value;const N=P;var z=r(20584),G=function(e,t,r,n){function a(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function i(e){try{s(n.next(e))}catch(t){o(t)}}function l(e){try{s(n["throw"](e))}catch(t){o(t)}}function s(e){e.done?r(e.value):a(e.value).then(i,l)}s((n=n.apply(e,t||[])).next())}))},Q=function(e,t){var r,n,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(e){return function(t){return s([e,t])}}function s(l){if(r)throw new TypeError("Generator is already executing.");while(o&&(o=0,l[0]&&(i=0)),i)try{if(r=1,n&&(a=2&l[0]?n["return"]:l[0]?n["throw"]||((a=n["return"])&&a.call(n),0):n.next)&&!(a=a.call(n,l[1])).done)return a;switch(n=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,n=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(a=i.trys,!(a=a.length>0&&a[a.length-1])&&(6===l[0]||2===l[0])){i=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){i.label=l[1];break}if(6===l[0]&&i.label<a[1]){i.label=a[1],a=l;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(l);break}a[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(s){l=[6,s],n=0}finally{r=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}};function V(){var e;return G(this,void 0,void 0,(function(){var t,r,n,a;return Q(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),N.loading=!0,[4,N.payload()];case 1:return t=o.sent(),r=(0,i.c)().getTitleOffline(),n={params:{titleOffline:r}},[4,z.c.update("apiRoutes.qramp.workOrders",null===(e=N.form)||void 0===e?void 0:e.id,t,n)];case 2:return o.sent(),N.loading=!1,[3,4];case 3:return a=o.sent(),console.info(a),N.loading=!1,[3,4];case 4:return[2]}}))}))}var Y=r(91416),K=function(e,t,r,n){function a(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function i(e){try{s(n.next(e))}catch(t){o(t)}}function l(e){try{s(n["throw"](e))}catch(t){o(t)}}function s(e){e.done?r(e.value):a(e.value).then(i,l)}s((n=n.apply(e,t||[])).next())}))},j=function(e,t){var r,n,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(e){return function(t){return s([e,t])}}function s(l){if(r)throw new TypeError("Generator is already executing.");while(o&&(o=0,l[0]&&(i=0)),i)try{if(r=1,n&&(a=2&l[0]?n["return"]:l[0]?n["throw"]||((a=n["return"])&&a.call(n),0):n.next)&&!(a=a.call(n,l[1])).done)return a;switch(n=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,n=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(a=i.trys,!(a=a.length>0&&a[a.length-1])&&(6===l[0]||2===l[0])){i=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){i.label=l[1];break}if(6===l[0]&&i.label<a[1]){i.label=a[1],a=l;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(l);break}a[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(s){l=[6,s],n=0}finally{r=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}};function B(e,t){var r=this;void 0===e&&(e=null),void 0===t&&(t=null);var a=(0,Y.c)(),l=((0,n._S)().proxy,(0,d.IL)(null)),s=(0,d.IL)(null),c=(0,n.S6)((function(){return N.loading})),p=(0,n.S6)((function(){return N.isUpdate})),m=(0,n.S6)((function(){return N.titleModal})),h=(0,n.S6)((function(){return N.widthModal})),b=(0,n.S6)({get:function(){return N.showModal},set:function(e){N.showModal=e}}),v=(0,d.IL)([{props:{color:"primary",label:u._s.tr("isite.cms.label.save")},action:function(){return K(r,void 0,void 0,(function(){return j(this,(function(e){return w(),[2]}))}))}}]),g=(0,n.S6)((function(){var e=N.form.statusId,n=[{props:{vIf:u.is.hasAccess("ramp.work-orders.destroy"),icon:"fa-regular fa-trash",class:"btn-action-fueling",label:a.screen.lt.sm?null:u._s.tr("isite.cms.label.delete"),loading:N.loading},action:function(){return K(r,void 0,void 0,(function(){return j(this,(function(e){switch(e.label){case 0:return N.loading=!0,[4,z.c.delete("apiRoutes.qramp.workOrders",N.form.id)];case 1:return e.sent(),N.reset(),[4,t("refresh-data")];case 2:return e.sent(),N.loading=!1,[2]}}))}))}},{props:{icon:"fa-regular fa-floppy-disk",label:a.screen.lt.sm?null:"Save to Draft",class:"btn-action-fueling",vIf:e==o._G||e==o.g1||e==o.kz,loading:N.loading},action:function(){return K(r,void 0,void 0,(function(){return j(this,(function(e){switch(e.label){case 0:return N.changeStatus(o._G),[4,I()];case 1:return e.sent(),[2]}}))}))}},{props:{icon:"fal fa-check",class:"close-btn-bg-color","text-color":"positive",label:u._s.tr("isite.cms.label.closeFlight"),vIf:e==o._G||e==o.g1||e==o.kz,loading:N.loading},action:function(){return K(r,void 0,void 0,(function(){return j(this,(function(e){switch(e.label){case 0:return N.changeStatus(o.g1),[4,I()];case 1:return e.sent(),[2]}}))}))}},{props:{icon:"fa-thin fa-floppy-disk",label:u._s.tr("isite.cms.label.save"),class:"btn-action-fueling",vIf:null==e||e==o.lC||e==o._y&&(0,i.c)().editPermissionseSubmitted(),loading:N.loading},action:function(){return K(r,void 0,void 0,(function(){return j(this,(function(e){switch(e.label){case 0:return[4,I()];case 1:return e.sent(),[2]}}))}))}},{props:{vIf:N.step>1,color:"white","text-color":"primary",icon:"fas fa-arrow-left"},action:function(){s.value.back()}},{props:{vIf:N.step<3,"text-color":"white",style:"background-color: #3865C2","icon-right":"fas fa-arrow-right"},action:function(){s.value.next()}}];return p.value?n:v.value}));function y(){N.reset(),(0,f.c)().setShowFavourite(!1),(0,f.c)().setErrorList([]),p.value&&t("refresh-data")}function w(){var e=this;l.value.$refs.formFueling.validate().then((function(t){return K(e,void 0,void 0,(function(){return j(this,(function(e){return t&&l.value.save(),[2]}))}))}))}function I(){return K(this,void 0,void 0,(function(){var e,t,r,n,a=this;return j(this,(function(i){switch(i.label){case 0:return[4,N.refsGlobal.refFlight.validate()];case 1:return e=i.sent(),e?[4,(0,f.c)().getServiceItems()]:(N.step=o.ey,n=q.find((function(e){return e.step===o.ey})),n.error=!0,u.Qb.error({message:u._s.tr("isite.cms.message.formInvalid")}),[2]);case 2:return t=i.sent(),0===t.length?(u.Qb.warning({mode:"modal",message:"Surely you want to save the work order without services",actions:[{label:u._s.tr("isite.cms.label.cancel"),color:"grey-8",handler:function(){return K(a,void 0,void 0,(function(){return j(this,(function(e){return N.loading=!1,[2]}))}))}},{label:u._s.tr("isite.cms.label.yes"),color:"primary",handler:function(){return K(a,void 0,void 0,(function(){return j(this,(function(e){switch(e.label){case 0:return[4,k()];case 1:return e.sent(),[2]}}))}))}}]}),[2]):[4,(0,f.c)().filterServicesListByQuantity()];case 3:return r=i.sent(),r.length>0?(N.step=o.uS,n=q.find((function(e){return e.step===o.uS})),n.error=!0,u.Qb.error({message:u._s.tr("You have services to correct")}),[2]):[4,k()];case 4:return i.sent(),[2]}}))}))}function k(){return K(this,void 0,void 0,(function(){var e;return j(this,(function(r){switch(r.label){case 0:return[4,V()];case 1:return r.sent(),N.reset(),(0,f.c)().setShowFavourite(!1),[4,t("refresh-data")];case 2:return r.sent(),e=u._s.tr("isite.cms.message.recordUpdated"),u.Qb.info({message:e}),[2]}}))}))}function S(){return K(this,void 0,void 0,(function(){return j(this,(function(e){switch(e.label){case 0:return[4,t("refresh-data")];case 1:return e.sent(),[2]}}))}))}return(0,n.u2)((function(){return K(r,void 0,void 0,(function(){return j(this,(function(e){return N.emitEvent.refreshData=S(),console.log(N.emitEvent),[2]}))}))})),(0,n.GE)((function(){N.reset(),(0,f.c)().setErrorList([]),(0,f.c)().setShowFavourite(!1)})),{showModal:b,clear:y,loading:c,titleModal:m,widthModal:h,actions:g,refCreateForm:l,save:w,isUpdate:p,refStepper:s,getDataTable:S}}function H(e,t,r,a,o,i){var l=(0,n.E1)("customer"),s=(0,n.E1)("dynamic-field"),u=(0,n.E1)("q-form");return(0,n.Wz)(),(0,n.An)("div",null,[(0,n.K2)(u,{ref:"formFueling",id:"simpleWordOrder",class:"tw-px-3 tw-pt-8 tw-pb-10 tw-my-4 tw-mx-8 tw-mb-32 tw-border tw-border-gray-200 tw-rounded-lg"},{default:(0,n.Ql)((function(){return[(0,n.K2)(l,{dataForm:e.form,addNewOptions:!1,ref:"refCustomer"},null,8,["dataForm"]),((0,n.Wz)(!0),(0,n.An)(n.ae,null,(0,n.mi)(e.fields.form,(function(t,r){return(0,n.Wz)(),(0,n.An)("div",{key:r,class:"col-12 col-md-6"},[(0,n.K2)(s,{modelValue:e.form[r],"onUpdate:modelValue":function(t){return e.form[r]=t},field:t},null,8,["modelValue","onUpdate:modelValue","field"])])})),128))]})),_:1},512)])}var J=function(){return J=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r],t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},J.apply(this,arguments)},X=function(e,t,r,n){function a(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function i(e){try{s(n.next(e))}catch(t){o(t)}}function l(e){try{s(n["throw"](e))}catch(t){o(t)}}function s(e){e.done?r(e.value):a(e.value).then(i,l)}s((n=n.apply(e,t||[])).next())}))},Z=function(e,t){var r,n,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(e){return function(t){return s([e,t])}}function s(l){if(r)throw new TypeError("Generator is already executing.");while(o&&(o=0,l[0]&&(i=0)),i)try{if(r=1,n&&(a=2&l[0]?n["return"]:l[0]?n["throw"]||((a=n["return"])&&a.call(n),0):n.next)&&!(a=a.call(n,l[1])).done)return a;switch(n=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,n=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(a=i.trys,!(a=a.length>0&&a[a.length-1])&&(6===l[0]||2===l[0])){i=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){i.label=l[1];break}if(6===l[0]&&i.label<a[1]){i.label=a[1],a=l;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(l);break}a[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(s){l=[6,s],n=0}finally{r=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}};function ee(e){return X(this,void 0,void 0,(function(){var t,r;return Z(this,(function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),N.showModal=!0,N.loading=!0,N.isUpdate=!0,N.titleModal="Update fueling"+(e.id?" Id: ".concat(e.id):""),N.widthModal="90vw",[4,z.c.show("apiRoutes.qramp.workOrders",e.id,{refresh:!0,params:{include:"customer,workOrderStatus,operationType,station,contract,responsible"}})];case 1:return t=n.sent(),[4,(0,i.c)().setIsPassenger(!0)];case 2:return n.sent(),N.form=J({},t.data),(0,i.c)().setTitleOffline(N.titleModal),N.loading=!1,[3,4];case 3:return r=n.sent(),console.info(r),[3,4];case 4:return[2]}}))}))}var te=function(){return te=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r],t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},te.apply(this,arguments)},re=function(e,t,r,n){function a(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function i(e){try{s(n.next(e))}catch(t){o(t)}}function l(e){try{s(n["throw"](e))}catch(t){o(t)}}function s(e){e.done?r(e.value):a(e.value).then(i,l)}s((n=n.apply(e,t||[])).next())}))},ne=function(e,t){var r,n,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(e){return function(t){return s([e,t])}}function s(l){if(r)throw new TypeError("Generator is already executing.");while(o&&(o=0,l[0]&&(i=0)),i)try{if(r=1,n&&(a=2&l[0]?n["return"]:l[0]?n["throw"]||((a=n["return"])&&a.call(n),0):n.next)&&!(a=a.call(n,l[1])).done)return a;switch(n=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,n=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(a=i.trys,!(a=a.length>0&&a[a.length-1])&&(6===l[0]||2===l[0])){i=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){i.label=l[1];break}if(6===l[0]&&i.label<a[1]){i.label=a[1],a=l;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(l);break}a[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(s){l=[6,s],n=0}finally{r=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}};function ae(e,t){void 0===e&&(e=null),void 0===t&&(t=null);var r=(0,d.IL)(null),a=(0,d.IL)(null),l=((0,n._S)().proxy,(0,n.S6)((function(){return u.is.hasAccess("ramp.work-orders.manage-responsible")}))),c=(0,d.IL)({customerId:null,contractId:null,statusId:o._G}),f=(0,n.S6)((function(){return{form:{stationId:{value:null,type:"select",props:{rules:[function(e){return!!e||u._s.tr("isite.cms.message.fieldRequired")}],selectByDefault:!0,label:"*".concat(u._s.tr("ifly.cms.form.station")),clearable:!0,color:"primary",options:(0,s["default"])().getStationList().map((function(e){return{label:e.fullName,value:e.id}}))}},responsibleId:{value:null,type:"select",props:{vIf:l.value,label:"Responsible",clearable:!0,color:"primary",hint:"If you left this field empty, the responsible will be you automatically"},loadOptions:{apiRoute:"apiRoutes.quser.users",select:{label:"fullName",id:"id"},filterByQuery:!0,requestParams:{filter:{companyId:o.mI}}}}}}}));function p(){return re(this,void 0,void 0,(function(){var e,t,r,n,a,l;return ne(this,(function(s){switch(s.label){case 0:s.trys.push([0,5,,6]),N.loading=!0,e="apiRoutes.qramp.simpleWorkOrders",t={businessUnitId:o.GK},r=te(te(te(te({},c.value),{titleOffline:(0,i.c)().getTitleOffline()}),t),{type:o.JU}),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,z.c.create(e,r)];case 2:return n=s.sent(),h(n.data),N.loading=!1,[3,4];case 3:return a=s.sent(),console.log(a),[3,4];case 4:return[3,6];case 5:return l=s.sent(),console.error(l),[3,6];case 6:return[2]}}))}))}function m(){c.value={customerId:null,contractId:null,statusId:o._G},N.showModal=!1}function h(e){var n=this;u.Qb.info({mode:"modal",title:"",message:"What do you want to do?",modalWidth:"600px",actions:[{label:"Go out to the list",color:"grey-6",handler:function(){return re(n,void 0,void 0,(function(){return ne(this,(function(e){switch(e.label){case 0:return[4,t("refreshData")];case 1:return e.sent(),[4,m()];case 2:return e.sent(),[2]}}))}))}},{label:"Continue editing",color:"light-blue-7",handler:function(){return re(n,void 0,void 0,(function(){return ne(this,(function(r){switch(r.label){case 0:return[4,ee(e)];case 1:return r.sent(),[4,t("refreshData")];case 2:return r.sent(),[2]}}))}))}},{label:"Create a new one",color:"positive",handler:function(){N.loading=!0,a.value.reset(),c.value={customerId:null,contractId:null,statusId:o._G},r.value.reset(),N.loading=!1}}]})}return{fields:f,form:c,save:p,refCustomer:a,formFueling:r}}var oe=function(){return oe=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r],t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},oe.apply(this,arguments)};const ie=(0,n._M)({components:{customer:g.c},setup:function(e,t){var r=t.emit;return oe({},ae(e,r))}}),le=(0,O.c)(ie,[["render",H]]),se=le;T()(ie,"components",{QForm:M.c});var ue={id:"stepComponent",class:"bg-white dynamicComponent stepper-modal-fueling"};function ce(e,t,r,a,o,i){var l=(0,n.E1)("q-step"),s=(0,n.E1)("q-stepper");return(0,n.Wz)(),(0,n.An)("div",ue,[(0,n.K2)(s,{modelValue:e.step,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.step=t}),ref:"refStepper","header-nav":"","alternative-labels":"",animated:"",contracted:e.$q.screen.lt.md,"keep-alive":"","active-icon":"none"},{default:(0,n.Ql)((function(){return[((0,n.Wz)(!0),(0,n.An)(n.ae,null,(0,n.mi)(e.stepps,(function(e,t){return(0,n.Wz)(),(0,n.Az)(l,{key:t,name:t+1,title:e.title,icon:e.icon,"active-color":e.error?"red":"primary",done:e.done},{default:(0,n.Ql)((function(){return[((0,n.Wz)(),(0,n.Az)((0,n.mk)(e.component)))]})),_:2},1032,["name","title","icon","active-color","done"])})),128))]})),_:1},8,["modelValue","contracted"])])}function de(){var e=(0,d.IL)(null);function t(){e.value.next()}function r(){e.value.previous()}var a=(0,n.S6)({get:function(){return N.step},set:function(e){N.step=e}});return{step:a,stepps:q,refStepper:e,next:t,back:r}}var fe=function(){return fe=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r],t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},fe.apply(this,arguments)};const pe=(0,n._M)({setup:function(e,t){t.emit;return fe({},de())}});var me=r(41564),he=r(41128),be=r(58120);const ve=(0,O.c)(pe,[["render",ce]]),ge=ve;T()(pe,"components",{QStepper:me.c,QStep:he.c,QIcon:be.c,QForm:M.c});var ye=function(){return ye=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r],t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},ye.apply(this,arguments)};const we=(0,n._M)({components:{createForm:se,stepper:ge},setup:function(e,t){var r=t.emit;return ye({},B(e,r))}}),Ie=(0,O.c)(we,[["render",c]]),ke=Ie;var Se=r(18528)["c"];const Oe={name:"RampCrud",components:{flightDetail:l.c,fuelingForm:ke},data(){return{crudId:this.$uid(),areaId:null,commentableId:null,loadingBulk:!1}},provide(){return{showWorkOrder:this.showWorkOrder,openModal:!0}},watch:{"$filter.values":{deep:!0,handler:function(e,t){JSON.stringify(e)!==JSON.stringify(t)&&(this.areaId=this.$filter.values.areaId)}},isAppOffline:{deep:!0,handler:async function(e){e||await(0,s["default"])().getWorkOrders(!0)}}},async created(){this.$nextTick((async()=>{await(0,i.c)().setIsPassenger(!0),await(0,i.c)().setIsFueling(!0),await(0,s["default"])().getAllList(),await(0,s["default"])().getCustomerWithContract()}))},beforeDestroy(){(0,i.c)().setFlightList([]),(0,i.c)().setFlightId(null)},computed:{isAppOffline(){return this.$store.state.qofflineMaster.isAppOffline},filter(){return this.$filter},editPermissionseSubmitted(){return(0,i.c)().editPermissionseSubmitted()},validateStatus(){return e=>e==o._G||e==o.g1||e==o.lC||e==o.kz||e==o._y&&this.editPermissionseSubmitted},crudData(){return{crudId:this.crudId,entityName:Se("main.qramp.entityNames.workOrders"),apiRoute:"apiRoutes.qramp.workOrders",permission:"ramp.fueling-work-orders",create:{method:async()=>{N.showModal=!0,N.titleModal="New fueling",N.widthModal="35vw"}},read:{columns:[{name:"id",label:this.$tr("isite.cms.form.id"),field:"id",style:"width: 50px",action:e=>!1},{name:"customer",label:this.$tr("isite.cms.label.customer"),field:e=>e.customCustomerName||e.customer,formatAsync:async e=>{const t=await(0,s["default"])().getCustomerList().find((t=>t.id===e.customerId))||{};return`${t.customerName||"-"}`},align:"left"},{name:"contract",label:"Contracts",field:"contract",format:e=>e?e.contractName:"-",align:"left"},{name:"flightStatus",label:"Flight Status",field:"flightStatus",align:"left",formatColumn:e=>{const t=(0,s["default"])().getFlightStatusesList().find((t=>t.id===e.flightStatusId))||{};return{bgTextColor:t&&t.color?`tw-bg-${t.color}`:""}},formatAsync:async e=>{const t=await(0,s["default"])().getFlightStatusesList().find((t=>t.id===e.flightStatusId))||{};return`${t.name||"-"}`}},{name:"statusName",label:this.$tr("isite.cms.form.status"),field:"workOrderStatus",formatAsync:async e=>{const t=await(0,s["default"])().getWorkOrderStatusesList().find((t=>t.id===e.statusId))||{},r=t?t.statusName+(e.needToBePosted?"(Posting)":""):"-";return`${r}`},align:"left"},{name:"station",label:"Station",field:"stationId",formatAsync:async e=>{if(!e.stationId)return"-";const t=await(0,s["default"])().getStationList().find((t=>t.id===e.stationId))||{};return`${t.fullName||"-"}`},align:"left"},{name:"responsible",label:"Responsible",field:"responsible",format:e=>e?e.fullName:"-",align:"left"},{name:"created_at",label:this.$tr("isite.cms.form.createdAt"),field:"createdAt",align:"left",format:e=>e?this.$trd(e):"-"},{name:"updated_at",label:this.$tr("isite.cms.form.updatedAt"),field:"updatedAt",align:"left",format:e=>e?this.$trd(e):"-"},{name:"actions",label:this.$tr("isite.cms.form.actions"),align:"left"}],filters:{date:{props:{label:"Scheduled date"},name:"scheduleDate",field:{value:"schedule_date"},quickFilter:!0},customerId:{value:null,type:"select",quickFilter:!0,loadOptions:{apiRoute:"apiRoutes.qramp.setupCustomers",select:{label:"customerName",id:"id"},requestParams:{filter:{companyId:o.mI}}},props:{label:"Customer",clearable:!0}},contractId:{value:null,type:"select",quickFilter:!0,loadOptions:{apiRoute:"apiRoutes.qramp.setupContracts",select:{label:"contractName",id:"id"},requestParams:{filter:{contractStatusId:1,businessUnitId:o.GK}}},props:{label:"Contract",clearable:!0}},statusId:{value:null,type:"select",quickFilter:!0,loadOptions:{apiRoute:"apiRoutes.qramp.workOrderStatuses",select:{label:"statusName",id:"id"},requestParams:{filter:{companyId:o.mI}}},props:{label:"Status",clearable:!0}},stationId:{value:null,type:"select",loadOptions:{apiRoute:"apiRoutes.qsetupagione.setupStations",select:{label:"fullName",id:"id"},requestParams:{filter:{companyId:o.mI}}},props:{label:"Station",clearable:!0}},adHoc:{value:null,type:"select",quickFilter:!0,props:{label:"Ad Hoc",clearable:!0,options:[{label:this.$tr("isite.cms.label.yes"),value:!0},{label:this.$tr("isite.cms.label.no"),value:!1}]}},businessUnitId:{value:o.GK}},requestParams:{include:"responsible,contract,customer",filter:{withoutDefaultInclude:!0,businessUnitId:o.GK,type:[o.JU]}},actions:[{name:"edit-workOrder",icon:"fal fa-pen",label:this.$tr("isite.cms.label.edit"),format:e=>({label:this.validateStatus(e.statusId)?this.$tr("isite.cms.label.edit"):this.$tr("isite.cms.label.show"),icon:this.validateStatus(e.statusId)?"fal fa-pen":"fal fa-eye"}),action:e=>{N.showModal=!0,N.loading=!0,N.isUpdate=!0,N.titleModal="Update fueling"+(e.id?` Id: ${e.id}`:""),N.widthModal="90vw",this.showWorkOrder(e)}},{name:"close",icon:"fal fa-check",label:this.$tr("isite.cms.label.closeFlight"),format:e=>({vIf:![o.lC,o._y,o.g1].includes(e.statusId)}),action:e=>{this.changeStatus(o.g1,e.id)}},{name:"submit",icon:"fal fa-check-double",label:this.$tr("isite.cms.label.submit"),format:e=>({vIf:this.$hasAccess("ramp.work-orders.submit")&&![o.lC,o._y].includes(e.statusId)}),action:e=>{this.changeStatus(o._y,e.id)}},{name:"post",icon:"fal fa-paper-plane",label:this.$tr("isite.cms.label.post"),action:e=>{this.changeStatus(o.lC,e.id)},format:e=>({vIf:this.$hasAccess("ramp.work-orders.post")&&!e.adHoc&&!e.needToBePosted&&![o.lC].includes(e.statusId),label:this.$tr("isite.cms.label.post")})},{name:"repost",icon:"fas fa-paper-plane",label:"Repost",action:e=>{this.changeStatus(o.lC,e.id)},format:e=>({vIf:this.$hasAccess("ramp.work-orders.re-post")&&!e.adHoc&&e.statusId==o.lC})},{name:"Reload Transactions",icon:"fa-light fa-download",label:"Reload Transactions",action:e=>{this.postReloadTransactions(e.id)},format:e=>({vIf:this.$hasAccess("ramp.fueling-work-orders.reload-transactions")&&!this.isAppOffline})}],bulkActions:[{apiRoute:"/ramp/v1/work-orders/bulk-post",permission:"ramp.fueling-work-orders.bulk-post",criteria:"id",props:{icon:"fas fa-paper-plane",label:"Post"}},{apiRoute:"/ramp/v1/work-orders/bulk-submit",permission:"ramp.fueling-work-orders.bulk-submit",criteria:"id",props:{icon:"fas fa-check",label:"Submit"}},{apiRoute:"/ramp/v1/work-orders/bulk-export-pdf",permission:"ramp.fueling-work-orders.bulk-export-pdf",criteria:"id",props:{icon:"fas fa-download",label:"Print Bulk(PDF)"}},{apiRoute:"/ramp/v1/work-orders/passenger-bulk-export-csv",permission:"ramp.fueling-work-orders.bulk-export-csv",criteria:"id",props:{icon:"fas fa-download",label:"Bulk(CSV)"}},{apiRoute:"/ramp/v1/work-orders/bulk-reload-transactions",permission:"ramp.fueling-work-orders.bulk-reload-transactions",criteria:"id",props:{icon:"fas fa-download",label:"Reload Transactions"}}],relation:{permission:"ramp.fueling-work-orders.see-workday-transactions",apiRoute:"apiRoutes.qramp.workOrderTransactions",requestParams:e=>({filter:{workOrderId:e.id},include:"product,contractLine"}),columns:[{name:"productId",label:"Sale Item Id",field:"product",format:e=>e?.externalId||"-"},{name:"productName",label:"Sale Item Name",field:"product",format:e=>e?.name||"-"},{name:"contractLineWorkdayId",label:"Contract LI Id",field:"contractLine",format:e=>e?.contractLineWorkdayId||"-"},{name:"invoiceLineMemo",label:"Invoice Line Memo",field:"contractLine",format:e=>e?.InvoiceLineMemo||"-"},{name:"quantity",label:"Quantity",field:"quantity"},{name:"rate",label:"Rate",field:"contractLine",format:e=>e?.rate||"-"},{label:"Total",field:e=>{const t=e.quantity||0,r=e.contractLine?.rate||0;return t*r}},{name:"transactionId",label:"Transaction Id",field:"transactionId"},{name:"postedAt",label:"Date Posted",field:"postedAt",format:e=>e?this.$trdT(e):"-"},{name:"amount",label:"ammount",field:"ammount"}]}},update:!1,delete:!0,formLeft:{}}},getCustomerName(){return e=>{let t=e;return e&&(t="object"===typeof e?e.customerName:e),t||"-"}},crudInfo(){return this.$store.state.qcrudComponent.component[this.crudId]||{}}},methods:{async getDataTable(e){await this.$refs.crudComponent.getDataTable(e)},async postReloadTransactions(e){try{this.loadingBulk=!0,await this.$crud.update("apiRoutes.qramp.reloadTransactions",e,{}),await this.getDataTable(!0),this.loadingBulk=!1}catch(t){this.loadingBulk=!1}},getOfflineTitleStatus(e,t){const r={1:"DRAFT",2:"POSTED",3:"SUBMITTED",4:"CLOSED",5:"SCHEDULE"};return`Work Order ${r[e]} - ID ${t}`},async changeStatus(e,t){const r="apiRoutes.qramp.workOrderChangeStatus",n="apiRoutes.qramp.workOrders",a={id:t,statusId:e};let o={params:{titleOffline:this.getOfflineTitleStatus(e,t)||""}};this.$emit("loading",!0),a.offline=this.isAppOffline,await u.a4.updateRecord(n,a,a?.id);const i=this.$crud.update(r,t,a,o);i.catch((e=>{this.$emit("loading",!1),this.isAppOffline||this.$alert.error({message:`${this.$tr("isite.cms.message.recordNoUpdated")}`})})).finally((()=>{this.$emit("loading",!1),this.$root.$emit("crud.data.refresh")}))},async openModal(e){await(0,i.c)().setIsPassenger(!0),N.form={...e},(0,i.c)().setTitleOffline(N.titleModal),N.loading=!1},showWorkOrder(e){this.isAppOffline?this.openModal(e):this.$crud.show("apiRoutes.qramp.workOrders",e.id,{refresh:!0,params:{include:"customer,workOrderStatus,operationType,station,contract,responsible"}}).then((async e=>{this.openModal(e.data)})).catch((e=>{console.log(e)}))},async getFlightMap(e){try{(0,i.c)().setWorkOrder(e),(0,i.c)().showVisibleMapModal()}catch(t){(0,i.c)().setWorkOrder(null),console.log(t)}}}},Me=(0,O.c)(Oe,[["render",a]]),Re=Me}}]);